
\begin{tikzpicture}

%Left
%\node[rotate=90] (x) at (-1,0) {$x$ inputs};
\node[rotate=-45] (img) at (-2.0,0.0) {\includegraphics[width=4cm]{images/black-cat-character.png}};
\node (xin) at (-2.0,-2.0) {Input};

\filldraw[fill=gray!33!white, draw=black] (0,-2.25) rectangle (1,2.25);
%\filldraw[fill=gray!33!white, draw=black] (1.25,-3) rectangle (2.25,3);
%\filldraw[fill=gray!33!white, draw=black] (2.5,-2) rectangle (3.5,2);


%Middle
\filldraw[fill=gray!50!white, draw=black,label=z] (5,-1) rectangle (6,1);

%q text
\node (qzx) at (3,0) {Encoder};
\node (z) at (5.5,0) {$z$};

%q lines, top then bot
\draw[thick] (1,-2.25) -- (5,-1);
\draw[thick] (1,2.25) -- (5,1);


%%
%%Here's the offset!
\def\x{8.5}
\def\bump{0.4}

\node[] (brackets) at (9.75,0.0)
  {\Huge$\left\{ \phantom{\sum^{big}_{t}\sum^{big}_{t} }\right\}$};
\node[] (img) at (8 + \bump,0.0) {\includegraphics[width=4cm]{images/black-cat-character.png}};
\draw[ultra thick,black] (9.5 + \bump,-1.25) -- (10.7 + \bump,1.25);

\node[inner sep=1pt] (rot) at (11.5 + \bump,0.0) {\Huge $\circlearrowright$};
\node (zlabel) at (10.0,-2.0) {Invariant Rep.};



%Middle part 2
\filldraw[fill=gray!50!white, draw=black,label=z] (5 + \x,-1) rectangle (6 + \x,1);
\filldraw[fill=blue!33!white, draw=black,label=z] (5 + \x,-2) rectangle (6 + \x,-1);

\node (z) at (5.5 + \x,0) {$z$};
\node (c) at (5.5 + \x,-1.5) {$c$};

%bottom
\filldraw[fill=gray!33!white, draw=black] (10 + \x,-2.25) rectangle (11 + \x,2.25);

%p(x|z) lines, top then bot
\node (pxz) at (8 + \x,-0.5) {Decoder};
\node (pxz) at (8 + \x,0.5) {$\circlearrowright$-Cond.};
\draw[thick] (6 + \x,1) -- (10 + \x,2.25);
\draw[thick] (6 + \x,-2) -- (10 + \x,-2.25);

%x recon branch text
\node[rotate=-45] (img_hat) at (13.5 + \x,0.0) {\includegraphics[width=4cm]{images/black-cat-character.png}};
\node (img_hat) at (13.5 + \x,1.0) {\Huge$\hat{\phantom{XXXX}}$};
\node (xout) at (13.5 + \x,-2.0) {Recon.};

\node (xout) at (0,-3.5) {\footnotesize{Cat Image taken from Yulia Sokolova's illustration tutorial.}};

\end{tikzpicture}


